<!DOCTYPE html>
<html>
<head>
<title>RandomStringGenerator</title>
<meta charset="utf8" />
<style>
body, input {
    font-size: 20px;
}
.symbol, .limit {
    width: 40px;
}
textarea {
    font-size: 24px;
    font-family: Consolas;
    width: 90%;
}
</style>
</head>
<body>

<p>Total Length <input type='text' id='inputLength' value='16' maxlength=4 /></p>
<input id='inputAdd' type='button' value='+' />
<input id='inputGo' type='button' value='Generate' /><br />
<textarea id='output' spellcheck='false' readonly=></textarea>

<script>
"use strict";

const ERROR_BG = 'pink';
document.querySelector('#inputLength').onblur = function() {
    this.style.backgroundColor = this.value.match(/^\d+$/) ? 'initial' : ERROR_BG;
};

const inputAdd = document.querySelector('#inputAdd');
inputAdd.onclick = function() {
    newConstraint('_', 100, false);
};

const deepRemove = function(obj) {
    while (obj.lastChild) {
        deepRemove(obj.lastChild);
    }
    obj.parentNode.remove(obj);
};

const newConstraint = function(symbol, defaultLimit, disabled) {
    const component = document.createElement('p');

    let inputRemove = document.createElement('input');
    inputRemove.type = 'button';
    inputRemove.value = '-';
    inputRemove.disabled = disabled;
    inputRemove.onclick = function() {
        deepRemove(this);
    };
    component.appendChild(inputRemove);

    component.appendChild(document.createTextNode(' Symbol '));
    let inputSymbol = document.createElement('input');
    inputSymbol.type = 'text';
    inputSymbol.value = symbol;
    inputSymbol.className = 'symbol';
    inputSymbol.setAttribute('maxlength', 1);
    inputSymbol.onblur = function() {
        this.style.backgroundColor = this.value.match(/^\w$/) ? 'initial' : ERROR_BG;
    };
    component.appendChild(inputSymbol);

    component.appendChild(document.createTextNode(' - Consecutive Limit '));
    let inputLimit = document.createElement('input');
    inputLimit.type = 'text';
    inputLimit.value = defaultLimit;
    inputLimit.className = 'limit';
    inputLimit.setAttribute('maxlength', 3);
    inputLimit.onblur = function() {
        this.style.backgroundColor = this.value.match(/^\d+$/) ? 'initial' : ERROR_BG;
    };
    component.appendChild(inputLimit);

    document.body.insertBefore(component, inputAdd);
};

const output = document.querySelector('#output');
document.querySelector('#inputGo').onclick = function() {
    for (let obj of document.querySelectorAll('input[type="text"]')) {
        if (obj.style.backgroundColor == ERROR_BG) {
            output.innerHTML = '(wrong inputs)';
            return;
        }
    }
    const components = [];
    document.querySelectorAll('.symbol').forEach(function(obj) {
        components.push({'symbol': obj.value});
    });
    document.querySelectorAll('.limit').forEach(function(obj, index) {
        components[index]['limit'] = parseInt(obj.value);
        components[index]['status'] = 0;
    });
    const totalSymbol = components.length;
    const totalLength = parseInt(inputLength.value);
    let resultSymbols = [];
    let resultLength = 0;
    let retriedTimes = 0;
    while (resultLength < totalLength) {
        let index = Math.floor(Math.random() * totalSymbol);
        let entry = components[index];
        if (entry['status'] >= entry['limit']) {
            if (++retriedTimes > 50) {
                output.innerHTML = '(no solution or try again)';
                return;
            }
            continue;
        }
        for (let i = 0; i < totalSymbol; ++i) {
            if (i == index)
                ++entry['status'];
            else
                components[i]['status'] = 0;
        }
        retriedTimes = 0;
        resultSymbols.push(entry['symbol']);
        if (++resultLength % 4 == 0)
            resultSymbols.push(' ');
    }
    output.innerHTML = resultSymbols.join('');
};

window.onload = function() {
    newConstraint('K', 2, true);
    newConstraint('R', 100, false);
    newConstraint('L', 100, false);
};

</script>
</body>
</html>
